<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Vitis HLS å®ç°æ‰‹å†™æ•°å­—è¯†åˆ« | Ayanami&#39;s blog</title>
<meta name="description" content="Life feeds on negative entropy" />
<link rel="shortcut icon" href="https://SylvanasQAQ.github.io/favicon.ico">
<link rel="stylesheet" href="https://SylvanasQAQ.github.io/styles/main.css">

<script src="https://SylvanasQAQ.github.io/media/js/jquery.min.js"></script>
<script src="https://SylvanasQAQ.github.io/media/js/masonry.pkgd.min.js"></script>
<script src="https://SylvanasQAQ.github.io/media/js/aos.js"></script>
<script src="https://SylvanasQAQ.github.io/media/js/pace.min.js"></script>
<script src="https://SylvanasQAQ.github.io/media/js/view-image.min.js"></script>
<script src="https://SylvanasQAQ.github.io/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://SylvanasQAQ.github.io/media/js/functions.js"></script>

    <meta name="referrer" content="never">
    <meta name="description" content="Vitis HLS (åŸ Vivado HLS ) æ˜¯ä¸€ä¸ªé«˜çº§ç»¼åˆå·¥å…·ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥å·¥å…·ç›´æ¥å°† C/C++ ç¼–å†™çš„å‡½æ•°ç¿»è¯‘æˆ HDL ç¡¬ä»¶æè¿°è¯­è¨€ï¼Œæœ€ç»ˆå†æ˜ å°„æˆ FPGA å†…éƒ¨çš„LUTã€DSP èµ„æºä»¥åŠ RAM èµ„æºç­‰ã€‚ç”¨æˆ·é€šè¿‡ Viti..." />
    <meta name="keywords" content="FPGA" />
    <script src="https://SylvanasQAQ.github.io/media/js/waterfall.min.js"></script>
    <script src="https://SylvanasQAQ.github.io/media/js/prism.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <!-- <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script> -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.5.1/styles/agate.min.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.5.1/highlight.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/11.5.1/languages/verilog.min.js"></script>  
    <script>hljs.highlightAll();</script>
    
    
    
    <style type="text/css">
        #footer a#md-toc {
            position: fixed;
            right: 20px;
            bottom: 80px;
            text-align: center;
            z-index: 99;
            border: 0;
            width: 40px;
            height: 40px;
            text-align: center;
            line-height: 40px;
            padding: 0;
        }

        #footer a#md-toc img {
            vertical-align: middle;
        }

        #footer a#md-toc i.fa {
            margin: 0;
        }

        #sidebar11 {
            position: fixed;
            height: 40%;
            width: 300px;
            right: -400px;
            top: 30%;
            z-index: 2147483647;
	    
        }

        /* When screen is wider than 800px */
        @media screen and (min-width: 800px) {
            .main{
                width: 85%;
            }
        }
    </style>
    <!--  -->
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://SylvanasQAQ.github.io"><img src="/media/images/logoo.png" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://SylvanasQAQ.github.io" class="menu">é¦–é¡µ</a></li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      å½’æ¡£
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tags" class="menu">
                      æ ‡ç­¾
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/post/about" class="menu">
                      å…³äº
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1653661119992" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="æœç‚¹å•¥..." aria-label="æœç‚¹å•¥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('https://SylvanasQAQ.github.io/post-images/bt9ZR2x4y.jpg');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="05-27-2022"><i class="fa fa-calendar"></i><span class="lately">7 å°æ—¶å‰</span></time>
              
              <a href="https://SylvanasQAQ.github.io/post/bt9ZR2x4y/#comments" class="comments meta-info" title="">
                <i class="fa fa-comment remixicon"></i><span class="comment-count valine-comment-count" data-xid="/post/bt9ZR2x4y/"> </span>
              </a>
              <span id="/post/bt9ZR2x4y/" class="leancloud_visitors views-counter meta-info" title=""><i class="fa fa-leancloud remixicon"></i><span class="leancloud-visitors-count"></span></span>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://SylvanasQAQ.github.io/tag/8q-hvEy6h/" class="ctag ctag-0 ctag-8q-hvEy6h" aria-label="">FPGA</a>
                    
              </div>
              <h1 class="title ularge white bold">Vitis HLS å®ç°æ‰‹å†™æ•°å­—è¯†åˆ«</h1>
            </div>
          </div>
        </div>  

        <div id="sidebar11" class="bg-white hosted v" style="padding-left: 10px; padding-right: 10px; overflow-y:scroll;">
            <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#1-%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%9E%8B">1 ç½‘ç»œæ¨¡å‹</a></li>
<li><a href="#2-%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83%E5%92%8C%E5%8F%82%E6%95%B0%E6%8F%90%E5%8F%96">2 æ¨¡å‹è®­ç»ƒå’Œå‚æ•°æå–</a></li>
<li><a href="#3-hls-%E4%BB%A3%E7%A0%81">3 HLS ä»£ç </a></li>
<li><a href="#4-%E4%BB%BF%E7%9C%9F%E5%92%8C%E7%BB%BC%E5%90%88%E7%BB%93%E6%9E%9C">4 ä»¿çœŸå’Œç»¼åˆç»“æœ</a></li>
<li><a href="#5-%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">5 å‚è€ƒæ–‡çŒ®</a></li>
</ul>

            </div>
        </div>

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <p>Vitis HLS (åŸ Vivado HLS ) æ˜¯ä¸€ä¸ªé«˜çº§ç»¼åˆå·¥å…·ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥å·¥å…·ç›´æ¥å°† C/C++ ç¼–å†™çš„å‡½æ•°ç¿»è¯‘æˆ HDL ç¡¬ä»¶æè¿°è¯­è¨€ï¼Œæœ€ç»ˆå†æ˜ å°„æˆ FPGA å†…éƒ¨çš„LUTã€DSP èµ„æºä»¥åŠ RAM èµ„æºç­‰ã€‚ç”¨æˆ·é€šè¿‡ Vitis HLSï¼Œä½¿ç”¨ C/C++ ä»£ç æ¥å¼€å‘ RTL IP æ ¸ï¼Œå¯ä»¥ç¼©çŸ­æ•´ä¸ª FPGA é¡¹ç›®çš„å¼€å‘å’ŒéªŒè¯æ—¶é—´ã€‚</p>
<h1 id="1-ç½‘ç»œæ¨¡å‹">1 ç½‘ç»œæ¨¡å‹</h1>
<p>LeNet æ˜¯æœ€æ—©å‘å¸ƒçš„å·ç§¯ç¥ç»ç½‘ç»œä¹‹ä¸€ï¼Œå› å…¶åœ¨è®¡ç®—æœºè§†è§‰ä»»åŠ¡ä¸­çš„é«˜æ•ˆæ€§èƒ½è€Œå—åˆ°å¹¿æ³›å…³æ³¨ã€‚è¿™ä¸ªæ¨¡å‹æ˜¯ç”± AT&amp;T è´å°”å®éªŒå®¤çš„ç ”ç©¶å‘˜ Yann LeCun åœ¨1989å¹´æå‡ºçš„ï¼Œç›®çš„æ˜¯è¯†åˆ«å›¾åƒä¸­çš„æ‰‹å†™æ•°å­—ã€‚æ€»ä½“æ¥çœ‹ï¼ŒLeNet (LeNet-5) ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<ul>
<li>å·ç§¯ç¼–ç å™¨ï¼šç”±ä¸¤ä¸ªå·ç§¯å—ç»„æˆï¼Œæ¯ä¸ªå·ç§¯å—ä¸­çš„åŸºæœ¬å•å…ƒæ˜¯ä¸€ä¸ªå·ç§¯å±‚ã€ä¸€ä¸ª sigmoid æ¿€æ´»å‡½æ•°å’Œå¹³å‡æ±‡èšå±‚</li>
<li>å…¨è¿æ¥å±‚å¯†é›†å—ï¼šç”±ä¸‰ä¸ªå…¨è¿æ¥å±‚ç»„æˆ</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://s2.loli.net/2022/05/27/84a9bgCh2WYc6RK.png" alt="LeNet æ¶æ„" width="730" height="182" loading="lazy"></figure>
<p>æœ¬æ–‡ä½¿ç”¨ç‹å°é›ª<a href="#ref_1">[1]</a>è®ºæ–‡ä¸­çš„ç½‘ç»œæ¨¡å‹ï¼Œè¯¥æ¨¡å‹å…±æœ‰äº”å±‚ï¼Œåˆ†åˆ«ä¸ºå·ç§¯å±‚ C1ã€é™é‡‡æ ·å±‚ S1ã€å·ç§¯å±‚ C2ã€é™é‡‡æ ·å±‚ S2 å’Œå…¨è¿æ¥å±‚ D1ã€‚åœ¨å·ç§¯å±‚ C1 ä¸­å®Œæˆçš„æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>28</mn><mo>Ã—</mo><mn>28</mn></mrow><annotation encoding="application/x-tex">28 \times 28</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span><span class="mord">8</span></span></span></span> çš„åˆå§‹è¾“å…¥å›¾åƒä¸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn><mo>Ã—</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">5 \times 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span> çš„å·ç§¯æ ¸ä¹‹é—´çš„å·ç§¯è®¡ç®—ã€‚åœ¨å·ç§¯å±‚ C2 ä¸­å®Œæˆçš„æ˜¯ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>12</mn><mo>Ã—</mo><mn>12</mn></mrow><annotation encoding="application/x-tex">12 \times 12</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">2</span></span></span></span> çš„ç‰¹å¾å›¾ä¸ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn><mo>Ã—</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">5 \times 5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span> çš„å·ç§¯æ ¸ä¹‹é—´çš„å·ç§¯è®¡ç®—ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://s2.loli.net/2022/05/27/ULC153EKmFSokqZ.png" alt="ç‹å°é›ªçš„ç½‘ç»œæ¨¡å‹" width="642" height="210" loading="lazy"></figure>
<h1 id="2-æ¨¡å‹è®­ç»ƒå’Œå‚æ•°æå–">2 æ¨¡å‹è®­ç»ƒå’Œå‚æ•°æå–</h1>
<p>ä½¿ç”¨ TensorFlow æ­å»ºç½‘ç»œæ¨¡å‹ï¼Œè€ƒè™‘åˆ°åç»­ä¼šä½¿ç”¨ä½ç²¾åº¦å®šç‚¹æ•°å­˜å‚¨æ¨¡å‹å‚æ•°ï¼Œå°†åç«¯é»˜è®¤çš„æµ®ç‚¹ç±»å‹è®¾ç½®ä¸º 16 ä½ã€‚</p>
<pre><code class="language-py">import tensorflow as tf

def LeNet():
    return tf.keras.models.Sequential([
        tf.keras.layers.Conv2D(filters=3, kernel_size=5, activation='sigmoid'),
        tf.keras.layers.AvgPool2D(pool_size=2, strides=2),
        tf.keras.layers.Conv2D(filters=12, kernel_size=5,
                               activation='sigmoid'),
        tf.keras.layers.AvgPool2D(pool_size=2, strides=2),
        tf.keras.layers.Flatten(),
        tf.keras.layers.Dense(10)])

tf.keras.backend.set_floatx('float16')
</code></pre>
<p>æ¨¡å‹è®­ç»ƒä½¿ç”¨çš„æ•°æ®é›†ä¸º MNISTï¼Œè®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„å¤„ç†å¦‚ä¸‹ï¼š</p>
<pre><code class="language-py">mnist_train, mnist_test = tf.keras.datasets.mnist.load_data()

batch_size = 256
process = lambda X, y: (tf.expand_dims(X, axis=3) / 255, tf.cast(y, dtype=&quot;int32&quot;))
resize_fn = lambda X, y: (tf.image.resize_with_pad(X, None, None) if None else X, y)

train_iter = (
    tf.data.Dataset.from_tensor_slices(process(*mnist_train))
    .batch(256)
    .shuffle(len(mnist_train[0]))
    .map(resize_fn)
)
test_iter = (
    tf.data.Dataset.from_tensor_slices(process(*mnist_test)).batch(256).map(resize_fn)
)
</code></pre>
<p>æ¨¡å‹è®­ç»ƒçš„ä»£ç å¦‚ä¸‹ï¼Œå°†è¡¨ç°æœ€å¥½çš„æ¨¡å‹ä¿å­˜åœ¨ <code>./weights/best_model.h5</code> ä¸­ã€‚</p>
<pre><code class="language-py">from keras.callbacks import EarlyStopping, ReduceLROnPlateau, ModelCheckpoint

# model fitting
if len(tf.config.experimental.list_physical_devices('GPU')) &gt;= 1:
    device = tf.device(f'/GPU:{0}')
else:
    device = tf.device('/CPU:0')
device_name = device._device_name
strategy = tf.distribute.OneDeviceStrategy(device_name)

lr = 0.9
num_epochs = 40
with strategy.scope():
    optimizer = tf.keras.optimizers.SGD(learning_rate=lr)
    loss = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)
    net = LeNet()
    net.compile(optimizer=optimizer, loss=loss, metrics=[&quot;accuracy&quot;])
earlystop_callback = EarlyStopping(monitor=&quot;accuracy&quot;, min_delta=0.0001, patience=5)
reduce_lr_callback = ReduceLROnPlateau(monitor=&quot;accuracy&quot;, factor=0.5, patience=3)
checkpoint_callback = ModelCheckpoint(
    &quot;./weights/best_model.h5&quot;, monitor=&quot;accuracy&quot;, save_best_only=True
)
net.fit(
    train_iter,
    epochs=num_epochs,
    verbose=1,
    callbacks=[earlystop_callback, reduce_lr_callback, checkpoint_callback],
)
</code></pre>
<p>ä»¥ä¸Šä»£ç å‚è€ƒäº†ã€ŠåŠ¨æ‰‹å­¦æ·±åº¦å­¦ä¹ ã€‹ç¬¬äºŒç‰ˆ<a href="#ref_2">[2]</a> 6.6 èŠ‚å·ç§¯ç¥ç»ç½‘ç»œ (LeNet) ä¸­çš„å†…å®¹ã€‚æ¨¡å‹è®­ç»ƒçš„è¿›å±•è¯¦æƒ…å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://s2.loli.net/2022/05/27/QtjyibolDvNeRhJ.png" alt="æ¨¡å‹è®­ç»ƒè¿›å±•å›¾" width="412" height="302" loading="lazy"></figure>
<p>æ¨¡å‹è®­ç»ƒå®Œæˆåï¼Œé€šè¿‡ <code>net.layers[i].get_weights()</code> èƒ½å¤Ÿè®¿é—®å„å±‚çš„å‚æ•°ã€‚å…ˆæŸ¥çœ‹å„å±‚å‚æ•°çš„ shapeï¼Œå¯ä»¥å‘ç°å…¶ä¸­åªæœ‰ä¸¤å±‚å·ç§¯å±‚ <code>Conv2D</code> å’Œä¸€å±‚å…¨è¿æ¥å±‚ <code>Dense</code> éœ€è¦ä¿å­˜å‚æ•°ã€‚</p>
<pre><code class="language-py">X = tf.random.uniform((1, 28, 28, 1))
for layer in net.layers:
    X = layer(X)
    print(layer.__class__.__name__, X.shape)
    for item in layer.weights:
        print('  ', item.name, '  \tshape: ', item.shape)

'''
Conv2D (1, 24, 24, 3)
   conv2d/kernel:0   	shape:  (5, 5, 1, 3)
   conv2d/bias:0   	shape:  (3,)
AveragePooling2D (1, 12, 12, 3)
Conv2D (1, 8, 8, 12)
   conv2d_1/kernel:0   	shape:  (5, 5, 3, 12)
   conv2d_1/bias:0   	    shape:  (12,)
AveragePooling2D (1, 4, 4, 12)
Flatten (1, 192)
Dense (1, 10)
   dense/kernel:0   	shape:  (192, 10)
   dense/bias:0   	    shape:  (10,)
'''
</code></pre>
<p>å°†å‚æ•°ä¿å­˜åœ¨ txt æ–‡ä»¶ä¸­ï¼Œè™½ç„¶ä¿å­˜ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶æ›´åŠ èŠ‚çœèµ„æºï¼Œä½†æ–‡æœ¬æ–‡ä»¶æ–¹ä¾¿è§‚å¯Ÿå’Œè°ƒè¯•ã€‚å‚æ•°ä¿å­˜çš„ç²¾åº¦ä¸ºå››ä½å°æ•°ã€‚</p>
<pre><code class="language-py"># path to your Vitis HLS testbehch folder
path = 'xxx'
# generate weight and bias files
file = open(path+'LeNet_weights.txt', 'w')
bias_arr = net.layers[0].get_weights()[1]
arr = net.layers[0].get_weights()[0].reshape(-1)
for i in range(25*3):
    file.write('%.4f ' % arr[i])
file.write('\n')
for i in range(3):
    file.write('%.4f ' % bias_arr[i])
file.write('\n')

bias_arr = net.layers[2].get_weights()[1]
arr = net.layers[2].get_weights()[0].reshape(-1)
for i in range(25*12*3):
    file.write('%.4f ' % arr[i])
file.write('\n')
for i in range(12):
    file.write('%.4f ' % bias_arr[i])
file.write('\n')

arr = net.layers[5].get_weights()[0].reshape(-1)
for i in range(1920):
    file.write('%.4f ' % arr[i])
file.write('\n')
arr = net.layers[5].get_weights()[1].reshape(-1)
for i in range(10):
    file.write('%.4f ' % arr[i])
file.close()
</code></pre>
<h1 id="3-hls-ä»£ç ">3 HLS ä»£ç </h1>
<p>è¯¥èŠ‚éƒ¨åˆ†ä»£ç çš„ä¼˜åŒ–å‚è€ƒäº†ä¸€ç¯‡ CSDN åšå®¢<a href="#ref_3">[3]</a>ï¼Œè¯¦è§ <a href="https://github.com/SylvanasQAQ/VitisHLS_LeNet">VitisHLS_LeNet</a>ã€‚</p>
<h1 id="4-ä»¿çœŸå’Œç»¼åˆç»“æœ">4 ä»¿çœŸå’Œç»¼åˆç»“æœ</h1>
<p>ä¸ºæ¯ä¸€å±‚çš„å‡½æ•°ç¼–å†™å¯¹åº”çš„ testbench æµ‹è¯•æ–‡ä»¶ï¼Œæ¯”è¾ƒç›¸åŒè¾“å…¥æ•°æ®ä¸‹ HLS C ä»¿çœŸçš„ç»“æœä¸ Python è¿ç®—çš„ç»“æœæ˜¯å¦åœ¨è¯¯å·®å…è®¸çš„èŒƒå›´å†…ã€‚è¯¯å·®é—¨é™ <code>ERROR_GAP</code> ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0.01</mn></mrow><annotation encoding="application/x-tex">0.01</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">1</span></span></span></span>ï¼Œæ¯è¶…è¿‡ä¸€æ¬¡é—¨é™ä¾¿ç»Ÿè®¡ä¸€æ¬¡ï¼Œå½“å•ä¸ªæµ‹è¯•ç”¨ä¾‹æœ‰ 10 æ¬¡è¶…è¿‡é—¨é™å°±åˆ¤å®šä¸ºå¤±è´¥ã€‚</p>
<pre><code class="language-cpp">if (hls::absf(expected_output_arr[i][k][r][c] - output_arr[k][r][c]) &gt; ERROR_GAP)
    mismatch_count++
</code></pre>
<p>ä½¿ç”¨ MNIST æµ‹è¯•é›†å‰ 100 ä¾‹æ•°æ®ç”¨äºå„å±‚çš„åŠŸèƒ½æµ‹è¯•ï¼Œç”¨å‰ 1000 ä¾‹æ•°æ®æµ‹è¯•æ•´ä¸ªç³»ç»Ÿçš„è¯†åˆ«æ­£ç¡®ç‡ã€‚C Simulation çš„ç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å„ä¸ªæ¨¡å—çš„æµ‹è¯•å‡æ— å¼‚å¸¸ï¼Œç³»ç»Ÿçš„è¯†åˆ«æ­£ç¡®ç‡ä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>98.0</mn></mrow><annotation encoding="application/x-tex">98.0%</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">9</span><span class="mord">8</span><span class="mord">.</span><span class="mord">0</span></span></span></span>ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://s2.loli.net/2022/05/27/A3BsNJl6MxZKiLP.jpg" alt="C Simulation è¾“å‡ºå›¾" loading="lazy"></figure>
<p>C Synthesis çš„éƒ¨åˆ†ç»“æœå¦‚ä¸‹ï¼Œæ•´ä¸ªæ¨¡å—çš„å»¶è¿Ÿä¸º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>308</mn><mi>Î¼</mi><mtext>s</mtext></mrow><annotation encoding="application/x-tex">308 \mu \text{s}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class="mord">3</span><span class="mord">0</span><span class="mord">8</span><span class="mord mathdefault">Î¼</span><span class="mord text"><span class="mord">s</span></span></span></span></span>ï¼Œæ—  Timing Violation å’Œ II Violationã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://s1.328888.xyz/2022/05/27/thKPT.png" alt="C Synthesis Results" loading="lazy"></figure>
<h1 id="5-å‚è€ƒæ–‡çŒ®">5 å‚è€ƒæ–‡çŒ®</h1>
<p><a id="ref_1"><a href="https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=CMFD&amp;dbname=CMFD201801&amp;filename=1018812356.nh">[1]ç‹å°é›ª. åŸºäºFPGAçš„å·ç§¯ç¥ç»ç½‘ç»œæ‰‹å†™æ•°å­—è¯†åˆ«ç³»ç»Ÿçš„å®ç°[D].åŒ—äº¬ç†å·¥å¤§å­¦,2016. </a> </a></p>
<p><a id="ref_2"><a href="https://zh.d2l.ai/index.html">[2]Zhang A, Lipton Z C, Li M, et al. Dive into deep learning[J]. arXiv preprint arXiv:2106.11342, 2021.</a> </a></p>
<p><a id="ref_3"><a href="https://blog.csdn.net/qq_36334929/article/details/108627123">[3]HLSå­¦ä¹ ç¬”è®°â€”â€”å®ç°å·ç§¯å±‚çš„åŠ é€Ÿè®¡ç®—</a> </a></p>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

        

            <section class="related section">
              
              
              <article class="next grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://SylvanasQAQ.github.io/post-images/PGELKesQU.jpg');"></div>
                 <a href="https://SylvanasQAQ.github.io/post/PGELKesQU/" class="full-link"></a>
                 <div class="info">
                  <time datetime="05-19-2022">05-19-2022</time>
                  <h4 class="title white no-margin">Verilog è¯­æ³•</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://SylvanasQAQ.github.io/media/images/right-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                <div class="clear"></div>
<script>
jQuery(document).ready(function($){
    $('.vemoji-btn').text('ğŸ˜€');
    $("#comments").on('click', 'span.vat',function(){
        $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
        $('textarea#veditor').focus();
    })
    if(window.location.hash){
        var checkExist = setInterval(function() {
            if ($(window.location.hash).length) {
                $('html, body').animate({scrollTop: $(window.location.hash).offset().top-200}, 600);
                clearInterval(checkExist);
            }
        }, 100);
    }
})
</script>

              </div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">æœ€æ–°æ–‡ç« </h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://SylvanasQAQ.github.io/post/bt9ZR2x4y/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://SylvanasQAQ.github.io/post-images/bt9ZR2x4y.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="05-27-2022">05-27-2022</time>
                      <h4 class="title usmall">
                        <a href="https://SylvanasQAQ.github.io/post/bt9ZR2x4y/">Vitis HLS å®ç°æ‰‹å†™æ•°å­—è¯†åˆ«</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://SylvanasQAQ.github.io/post/PGELKesQU/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://SylvanasQAQ.github.io/post-images/PGELKesQU.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="05-19-2022">05-19-2022</time>
                      <h4 class="title usmall">
                        <a href="https://SylvanasQAQ.github.io/post/PGELKesQU/">Verilog è¯­æ³•</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://SylvanasQAQ.github.io/post/0_rHJUypa/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://SylvanasQAQ.github.io/post-images/0_rHJUypa.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="04-29-2022">04-29-2022</time>
                      <h4 class="title usmall">
                        <a href="https://SylvanasQAQ.github.io/post/0_rHJUypa/">ç¬¬ 6 ç« å®¶åº­ä½œä¸š</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">æ ‡ç­¾äº‘</h4>
                  <div class="tagcloud">
                    
                      <a href="https://SylvanasQAQ.github.io/tag/8q-hvEy6h/" class="ctag ctag-0 ctag-8q-hvEy6h" aria-label="">FPGA</a>
                    
                      <a href="https://SylvanasQAQ.github.io/tag/6PZSNKfJ9/" class="ctag ctag-1 ctag-6PZSNKfJ9" aria-label="">CSAPP</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">å…³äºæˆ‘</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://SylvanasQAQ.github.io/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="https://SylvanasQAQ.github.io/post/about ">Ayanami&#39;s blog</a></h4>
                    <p class="founder">Life feeds on negative entropy</p>
                    <div class="social">
                      
                          
                            <a href="https://github.com/SylvanasQAQ" class="translate-effect" target="_blank"><i class="fa fa-github"></i></a>
                        
                      
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://SylvanasQAQ.github.io"><img src="/media/images/gridea.png" alt=""></a>
        </div>
        <p class="published border-effect">
          Â©2022 å…± 6 ç¯‡æ–‡ç« 
          <br/>
          Theme <a href="https://gridea.dev/" target="_blank">ã€Œbreekã€</a> Powered by <a href="https://gridea.dev/" target="_blank">ã€ŒGrideaã€</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>

        <a href="javascript:void(0)" id="md-toc" class="epcl-button dark" style="display:none">
          <i class="fa"><svg t="1650112028452" class="icon" viewBox="0 -150 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2752" width="30" height="30"><path d="M124 256.992q0-26.016 18.496-44.512t44.512-18.496 44.512 18.496 18.496 44.512-18.496 44.512T187.008 320t-44.512-18.496-18.496-44.512z m732 29.024H357.984q-15.008 0-25.504-10.496t-10.496-25.504q0-15.008 10.496-25.504t25.504-10.496H856q15.008 0 25.504 10.496t10.496 25.504q0 15.008-10.496 25.504t-25.504 10.496zM124 512q0-26.016 18.496-44.512t44.512-18.496 44.512 18.496T250.016 512t-18.496 44.512-44.512 18.496-44.512-18.496T124 512z m732 28.992H357.984q-15.008 0-25.504-10.496t-10.496-25.504q0-15.008 10.496-25.504t25.504-10.496H856q15.008 0 25.504 10.496t10.496 25.504q0 15.008-10.496 25.504t-25.504 10.496zM124 767.008q0-26.016 18.496-44.512T187.008 704t44.512 18.496 18.496 44.512-18.496 44.512-44.512 18.496-44.512-18.496-18.496-44.512z m732 28.992H357.984q-15.008 0-25.504-10.496t-10.496-25.504q0-15.008 10.496-25.504t25.504-10.496H856q15.008 0 25.504 10.496t10.496 25.504q0 15.008-10.496 25.504t-25.504 10.496z" p-id="2753" fill="#e8e8e8"></path></svg></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        
<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script> -->
<script src="https://SylvanasQAQ.github.io/media/js/av-min.js"></script>
<script type="text/javascript" src="https://cdn.staticfile.org/valine/1.3.10/Valine.Pure.min.js"></script>
<script>
    new Valine({
        el: '#comments',
        appId: 'eRwxRootBaBzDBwoutG7bLYE-gzGzoHsz' ,
        appKey: '7NuCOYYcsdap67sNFgVsIHUm',
        pageSize: 30,
        placeholder: 'æ—¢ç„¶æ¥äº†ï¼Œé‚£å°±ç•™ä¸ªç—•è¿¹å§~',
        visitor: true // é˜…è¯»é‡ç»Ÿè®¡
    })
</script>
    

      
    <script src="https://SylvanasQAQ.github.io/media/js/functions-post.js"></script>
     <script>
      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;
	  let halfHeight = document.body.clientHeight*0.8;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop+halfHeight) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop+halfHeight) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    


      (function ($) {
            "use strict";
                var bt;
                var isHiden = true;

                window.onmouseup = function(obj){
                    if(obj.toElement.className == "epcl-button dark" || obj.toElement.className instanceof SVGAnimatedString || obj.toElement.className == "bg-white hosted v" || obj.toElement.className == "toc-container")
                        return;
                    if (isHiden == false) {
                        $('#sidebar11').animate({ right: '-400px' }); //ç›®å½•å—å‘å·¦ç§»åŠ¨
                        isHiden = !isHiden;
                    }
                };

                bt = $('#md-toc');
                $(window).scroll(function () {
                    var st;
                    st = $(window).scrollTop();
                    return bt.css('display', 'block');
                });
                return bt.on('click', function (event) {
                    if (isHiden) {
                        $('#sidebar11').animate({ right: '0' }).show();//ç›®å½•å—å‘å³ç§»åŠ¨
                    } else {
                        $('#sidebar11').animate({ right: '-400px' }); //ç›®å½•å—å‘å·¦ç§»åŠ¨
                    }
                    isHiden = !isHiden;
                    return false;
                });
        })(jQuery);
    </script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
